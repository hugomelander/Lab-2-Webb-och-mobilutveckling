<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="ConcertBooking.Mobile.Views.ConcertsPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:viewModels="clr-namespace:ConcertBooking.Mobile.ViewModels"
    xmlns:models="clr-namespace:ConcertBooking.Mobile.Models"
    x:DataType="viewModels:ConcertsViewModel"
    Title="Föreställningar"
    x:Name="this">

    <ScrollView>
        <VerticalStackLayout Padding="16" Spacing="12">

            <Button
                Text="Visa mina bokningar"
                BackgroundColor="Purple"
                TextColor="White"
                Command="{Binding ShowMyBookingsCommand}" />

            <ActivityIndicator IsRunning="{Binding IsBusy}" IsVisible="{Binding IsBusy}" />

            <Label Text="{Binding ErrorMessage}" TextColor="Red" FontSize="14" />

            <VerticalStackLayout IsVisible="{Binding MyBookings.Count}">
                <Label 
                    Text="Dina bokningar (svep för att avboka)" 
                    FontSize="18" 
                    FontAttributes="Bold" 
                    TextColor="Purple"
                    Margin="0,10,0,5" />

                <CollectionView ItemsSource="{Binding MyBookings}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:MyBookingDto">
                            <SwipeView>
                                <SwipeView.RightItems>
                                    <SwipeItems Mode="Reveal">
                                        <SwipeItem 
                                            Text="Avboka" 
                                            BackgroundColor="Red"
                                            Command="{Binding Source={x:Reference this}, Path=BindingContext.CancelBookingCommand}"
                                            CommandParameter="{Binding .}" />
                                    </SwipeItems>
                                </SwipeView.RightItems>

                                <Border Padding="12" Margin="0,4" BackgroundColor="#F0F0F0">
                                    <VerticalStackLayout Spacing="2">
                                        <Label Text="{Binding Performance.ConcertTitle}" 
               FontSize="18" 
               FontAttributes="Bold" 
               TextColor="Purple" />
                                        <Label Text="{Binding Performance.Location}" FontSize="16" FontAttributes="Bold" />
                                        <Label Text="{Binding Performance.DateTime, StringFormat='{0:yyyy-MM-dd HH:mm}'}" FontSize="13" />
                                        <Label Text="{Binding Name, StringFormat='Bokad för: {0}'}" FontSize="12" TextColor="Gray" />
                                    </VerticalStackLayout>
                                </Border>
                            </SwipeView>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <BoxView HeightRequest="2" Color="LightGray" Margin="0,15" />
            </VerticalStackLayout>

            <Label Text="Aktuella konserter" FontSize="18" FontAttributes="Bold" />

            <CollectionView ItemsSource="{Binding Concerts}" 
                            SelectionMode="Single"
                            SelectedItem="{Binding SelectedConcert, Mode=TwoWay}">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:ConcertDto">
                        <Border Padding="12" Margin="0,6" BackgroundColor="Orange">
                            <VerticalStackLayout Spacing="6">
                                <Label Text="{Binding Title}" FontSize="18" FontAttributes="Bold" />
                                <Label Text="{Binding Description}" FontSize="14" />
                                <Label Text="{Binding BookingsCount, StringFormat='Totalt antal bokningar: {0}'}" FontSize="12" />
                            </VerticalStackLayout>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>